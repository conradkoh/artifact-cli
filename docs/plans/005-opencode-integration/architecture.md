# Plan 005: OpenCode Integration - Architecture

## Changes Overview

| Component | Type | Description |
|-----------|------|-------------|
| CLI Command | New | `artifact opencode install` command |
| Tool Template | New | OpenCode tool definition template |

## New Components

### CLI Command (`src/cli/commands/opencode.ts`)

New command that:
1. Creates `~/.config/opencode/tool/` directory if needed
2. Writes the tool definition file
3. Outputs success message

### Tool Definition Template

The generated file follows OpenCode conventions:

```typescript
import { tool } from "@opencode-ai/plugin"

export const create = tool({
  description: "Create an artifact preview from a React component file",
  args: {
    file: tool.schema.string().describe("Path to the React component file"),
  },
  async execute(args) {
    const result = await Bun.$`artifact create ${args.file}`.text()
    return result.trim()
  },
})

export const update = tool({
  description: "Update an existing artifact with latest code changes",
  args: {
    id: tool.schema.string().describe("Artifact ID to update"),
  },
  async execute(args) {
    const result = await Bun.$`artifact update ${args.id}`.text()
    return result.trim()
  },
})

export const preview = tool({
  description: "Open an artifact preview in the browser",
  args: {
    id: tool.schema.string().describe("Artifact ID to preview"),
  },
  async execute(args) {
    const result = await Bun.$`artifact preview ${args.id}`.text()
    return result.trim()
  },
})
```

This creates three tools:
- `artifact-cli_create`
- `artifact-cli_update`
- `artifact-cli_preview`

## File System

```
~/.config/opencode/tool/
└── artifact-cli.ts    # Generated by `artifact opencode install`
```

## Implementation Notes

1. Use `os.homedir()` to get home directory
2. Use `fs.mkdirSync` with `recursive: true` for directory creation
3. Check if artifact-cli is globally accessible (warn if not)
